# Математическая модель роевой системы синхронизации

## 1. Модель динамики беспилотника

### Уравнения движения
Позиция: **r(t) = [x(t), y(t), z(t)]^T**

Скорость: **v(t) = dr/dt**

Ускорение: **a(t) = dv/dt**

### Динамическая модель
```
m * a = F_control + F_external
```
где:
- m - масса беспилотника
- F_control - управляющая сила
- F_external - внешние силы (гравитация, ветер, сопротивление)

### ПИД-регулятор позиции
```
u(t) = Kp * e(t) + Ki * ∫e(τ)dτ + Kd * de/dt
```
где e(t) = r_target - r(t) - ошибка позиции

## 2. Алгоритмы консенсуса

### Усредняющий консенсус
```
x_i(t+1) = w_ii * x_i(t) + Σ(w_ij * x_j(t))
```
где w_ij - веса связей между агентами

### Матрица Лапласа графа
```
L = D - A
```
где D - диагональная матрица степеней, A - матрица смежности

### Скорость сходимости
Определяется вторым собственным значением λ_2(L) (алгебраическая связность)

## 3. Синхронизация времени

### Модель часов
```
T_local = T_global + offset + drift * t
```

### Алгоритм Cristian
```
offset = T_remote - T_local - RTT/2
```
где RTT - время туда-обратно

### Фильтр Калмана для оценки смещения
Состояние: **x = [offset, drift]^T**

Модель:
```
x(k+1) = F * x(k) + w(k)
z(k) = H * x(k) + v(k)
```

## 4. Синхронизация фазы (модель Курамото)

### Уравнение динамики фазы
```
dθ_i/dt = ω_i + (K/N) * Σ sin(θ_j - θ_i)
```
где:
- θ_i - фаза i-го осциллятора
- ω_i - естественная частота
- K - сила связи

### Параметр порядка
```
r * e^(iψ) = (1/N) * Σ e^(iθ_j)
```
где r ∈ [0,1] - степень синхронизации

## 5. Формирование строя

### Виртуальная структура
Позиция агента i в формации:
```
p_i = p_center + R(φ) * s * δ_i
```
где:
- p_center - центр формации
- R(φ) - матрица поворота
- s - масштаб
- δ_i - относительная позиция в формации

### Управление формацией
```
u_i = K_p * (p_i^ref - p_i) - K_d * v_i + K_i * ∫(p_i^ref - p_i)dt
```

## 6. Избегание столкновений

### Искусственные потенциальные поля
Отталкивающий потенциал:
```
U_rep = 0.5 * k * (1/d - 1/d_0)^2, если d < d_0
```

Сила отталкивания:
```
F_rep = -∇U_rep = k * (1/d - 1/d_0) * (1/d^2) * (r/|r|)
```

### Velocity Obstacle (VO)
Конус столкновения:
```
VO = {v | ∃t ∈ [0, τ]: |p_i + v*t - (p_j + v_j*t)| < r_i + r_j}
```

### ORCA (Optimal Reciprocal Collision Avoidance)
Полуплоскость допустимых скоростей:
```
ORCA_i|j = {v | (v - v_opt) · n ≥ 0}
```

### Барьерные функции (CBF)
Условие безопасности:
```
ḣ(x, u) + α(h(x)) ≥ 0
```
где h(x) - барьерная функция

## 7. Метрики производительности

### Связность роя
```
C = |E| / (N*(N-1)/2)
```
где |E| - число ребер в графе связи

### Ошибка формации
```
E_formation = (1/N) * Σ |p_i - p_i^ref|
```

### Качество синхронизации времени
```
Q_sync = 1 / (1 + var(offsets))
```

### Когерентность фаз
```
Coherence = |Σ e^(iθ_j)| / N
```

## 8. Оптимизация

### Функция стоимости
```
J = α_1 * E_formation + α_2 * E_collision + α_3 * E_energy + α_4 * E_sync
```

### Ограничения
- Максимальная скорость: |v| ≤ v_max
- Максимальное ускорение: |a| ≤ a_max
- Минимальное расстояние: |r_i - r_j| ≥ d_min
- Связность графа: λ_2(L) > 0

## Параметры системы

| Параметр | Значение | Единица |
|----------|----------|---------|
| Масса дрона | 1.5 | кг |
| Макс. скорость | 20 | м/с |
| Макс. ускорение | 10 | м/с² |
| Радиус связи | 100 | м |
| Безопасный радиус | 2 | м |
| Период синхронизации | 1 | с |
| Коэффициент Kp | 2.0 | - |
| Коэффициент Kd | 1.0 | - |
| Коэффициент Ki | 0.1 | - |

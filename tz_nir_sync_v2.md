### Техническое задание на НИР
# Разработка технологии распределенной частотно-временной синхронизации роевых беспилотных систем на основе протокола PNTP и ансамблей часов

Версия: 1.0 (доработанная)

Дата: 2025-08-21

Основание: материалы Заказчика; наработки `RCB_WWVB_LORA/V2`, `RCB_WWVB_RP2040`; презентация по синхронизации с концепцией PNTP и ансамблей часов.

Ответственный исполнитель: указывается Заказчиком.

Срок выполнения НИР: 18 месяцев (включая предварительные исследования).

---

## 1. Предмет и цель НИР

**Цель:** разработка технологии распределенной частотно-временной синхронизации (ЧВС) на основе протокола PNTP и ансамблей часов для роевых беспилотных систем, обеспечивающей автономную работу в условиях отсутствия или подавления GNSS.

**Предмет:** 
- Протокол PNTP (Position, Navigation & Time Protocol) для движущихся платформ
- Алгоритмы создания и управления распределенными ансамблями часов
- Методы компенсации динамических задержек и релятивистских эффектов
- Архитектурные решения для синхронизации в гетерогенных беспроводных сетях (60 кГц — 6 ГГц)

## 2. Основания и источники

- Наработки: репозитории `RCB_WWVB_LORA/V2`, `RCB_WWVB_RP2040`
- Материалы: презентация по PNTP и ансамблям часов (ссылки у Заказчика)
- Стандарты: IEEE 1588-2008/2019 (PTP), IEEE 802.1AS (gPTP), LoRa PHY/MAC, Wi-Fi TSF
- Исследования: публикации по PNTP, Time Scale Ensembles, релятивистской синхронизации

## 3. Область применения и актуальность

### 3.1. Область применения
- **Роевые системы:** группы БПЛА (до 100 единиц), наземные робототехнические комплексы
- **Условия эксплуатации:** 
  - GNSS-denied environments (подавление, экранирование)
  - Динамически изменяющаяся топология сети
  - Высокая мобильность узлов (до 200 км/ч для БПЛА)
- **Сети:** суб-ГГц LPWAN (LoRa), Wi-Fi 2.4/5/6 ГГц, Ethernet/WBR, опционально 5G/private LTE

### 3.2. Актуальность проблемы
- Критическая зависимость современных БпС от GNSS создает уязвимость
- Необходимость координированных действий роя требует точной синхронизации
- Существующие протоколы (NTP/PTP) не оптимизированы для движущихся платформ

## 4. Задачи НИР

### 4.1. Основные задачи
1) Провести анализ и адаптацию протокола PNTP для роевых беспилотных систем
2) Разработать алгоритмы создания и управления распределенными ансамблями часов на движущихся платформах
3) Создать информационную и математическую модель системы ЧВС с учетом динамики платформ и релятивистских эффектов
4) Разработать методы оптимальной оценки задержек между случайно движущимися платформами
5) Создать демонстратор системы распределенной ЧВС для роевых БпС
6) Экспериментально проверить работу системы в условиях отсутствия GNSS
7) Исследовать концепцию "ансамблей ансамблей" для иерархических структур управления
8) Разработать комплект научно-технической документации и Проект ТЗ на ОКР

### 4.2. Исследовательские вопросы
- Как оптимально оценивать задержки между случайно движущимися платформами?
- Как генерировать ансамблевое время, более стабильное, чем отдельные часы?
- Как оптимизировать производительность распределенного ансамбля?
- Могут ли "ансамбли ансамблей" повысить устойчивость системы?
- Как эффективно управлять динамическим составом ансамбля?
- Какова оптимальная стратегия переключения между источниками времени?

## 5. Требования к технологии и системе

### 5.1. Функциональные требования
- **Источники времени:** 
  - WWVB 60 кГц (резервный)
  - Внешний PPS/GNSS (при доступности)
  - Распределенный ансамбль часов (основной в GNSS-denied)
  - Протокол PNTP для обмена PNT-данными

- **Режимы работы:**
  - Участник ансамбля (contributor)
  - Потребитель времени (consumer)
  - Шлюз между доменами (gateway)
  - Автономный holdover
  - Динамическое переключение ролей

- **Поддержка динамики:**
  - Измерение 3D-положения и относительных скоростей
  - Компенсация эффекта Доплера
  - Учет релятивистских поправок
  - Предсказание траекторий движения

### 5.2. Технические требования

| Параметр | Требование | Примечание |
|---|---|---|
| Масштаб роя | До 100 узлов | С возможностью иерархической организации |
| Точность синхронизации (p95) | | |
| - В ансамбле (PNTP) | ≤ 1 мс | Для координированного полета |
| - LoRa домен | ≤ 5 мс | Дальняя связь |
| - Wi-Fi PTP/gPTP | ≤ 50 мкс | С HW таймстемпами |
| - WWVB-only | ≤ 20 мс | Резервный режим |
| Holdover | ≤ 5 мс/час | При потере всех источников |
| Время сходимости ансамбля | ≤ 30 с | После инициализации |
| Устойчивость к потерям | До 30% узлов | Без деградации точности |
| Скорость платформ | До 200 км/ч | Типичная для БПЛА |
| Дальность связи | | |
| - LoRa | До 10 км | LOS условия |
| - Wi-Fi | До 1 км | Mesh топология |

### 5.3. Требования безопасности
- Аутентификация участников ансамбля (PKI/сертификаты)
- Шифрование PNTP сообщений (AES-256)
- Защита от spoofing атак на временные метки
- Обнаружение и изоляция скомпрометированных узлов
- Резервирование критических функций

## 6. Протокол PNTP (Position, Navigation & Time Protocol)

### 6.1. Основные характеристики
- Расширение PTP/NTP для движущихся платформ
- Интегрированная передача времени, положения и скорости
- Поддержка TOA (Time of Arrival) и TDOA (Time Difference of Arrival)
- Встроенная компенсация релятивистских эффектов

### 6.2. Структура сообщений PNTP

| Поле | Размер | Описание |
|---|---|---|
| Timestamp | 80 бит | Временная метка (наносекунды) |
| Position | 3×32 бит | 3D координаты (ECEF) |
| Velocity | 3×16 бит | Вектор скорости |
| Acceleration | 3×16 бит | Вектор ускорения |
| Clock_quality | 8 бит | Качество локальных часов |
| Relativistic_correction | 16 бит | Релятивистская поправка |
| Ensemble_ID | 16 бит | Идентификатор ансамбля |
| Signature | 256 бит | Цифровая подпись |

### 6.3. Режимы работы PNTP
- **Unicast:** точка-точка для высокой точности
- **Multicast:** для синхронизации группы
- **Broadcast:** маяки времени для всего роя

## 7. Распределенные ансамбли часов

### 7.1. Концепция ансамблей
- Объединение данных от множества часов для создания стабильного эталона
- Отсутствие единой точки отказа
- Статистическое улучшение точности
- Автоматическая адаптация к изменениям состава

### 7.2. Алгоритмы ансамблирования

```
Ансамблевое время T_ens = Σ(w_i × T_i) / Σ(w_i)

где:
- T_i - время i-го участника
- w_i - вес, зависящий от:
  - Качества часов (Allan deviation)
  - Истории стабильности
  - Текущего SNR/RSSI
  - Количества соседей
```

### 7.3. Иерархия ансамблей
- **Уровень 1:** Локальные ансамбли (5-10 БПЛА)
- **Уровень 2:** Региональные ансамбли (объединение локальных)
- **Уровень 3:** Глобальный ансамбль роя
- Возможность создания "ансамблей ансамблей"

### 7.4. Управление составом ансамбля
- Динамическое включение/исключение участников
- Критерии качества для участия
- Механизмы голосования и консенсуса
- Обработка Byzantine failures

## 8. Математическая модель

### 8.1. Модель часов с учетом движения
```
f(t) = f₀[1 + Δf/f₀ + α(T-T₀) + β(v²/c²) + γ(Φ/c²)] + ξ(t)

где:
- f₀ - номинальная частота
- Δf/f₀ - начальное смещение
- α - температурный коэффициент
- β - релятивистский коэффициент (спец. относительность)
- γ - гравитационный коэффициент
- Φ - гравитационный потенциал
- ξ(t) - стохастический шум
```

### 8.2. Модель задержек для движущихся платформ
```
τ(t) = |r_j(t) - r_i(t)|/c + τ_prop + τ_proc + δ_Doppler(v_rel)

где:
- r_i(t), r_j(t) - положения платформ
- τ_prop - задержка распространения
- τ_proc - задержка обработки
- δ_Doppler - доплеровская поправка
- v_rel - относительная скорость
```

### 8.3. Оценивание состояния ансамбля
- Extended Kalman Filter (EKF) для нелинейной динамики
- Unscented Kalman Filter (UKF) для высокой нелинейности
- Particle Filter для мультимодальных распределений
- Робастная регрессия для outlier rejection

### 8.4. Предсказание траекторий
- Полиномиальная экстраполяция для краткосрочного прогноза
- Модели движения (constant velocity/acceleration)
- Machine Learning для паттернов полета

## 9. Алгоритмы синхронизации

### 9.1. Инициализация ансамбля
1. Обнаружение соседей и обмен качеством часов
2. Выбор начального опорного узла (best clock)
3. Грубая синхронизация через broadcast
4. Точная синхронизация через unicast PNTP

### 9.2. Поддержание синхронизации
1. Периодический обмен PNTP сообщениями
2. Вычисление попарных смещений и задержек
3. Обновление ансамблевого времени
4. Коррекция локальных часов

### 9.3. Обработка аномалий
- Обнаружение выбросов (3-sigma rule)
- Изоляция неисправных узлов
- Плавное переключение при потере лидера
- Восстановление после разделения сети

## 10. Архитектура системы

### 10.1. Компоненты узла
```
┌─────────────────────────────────────┐
│         Узел роевой системы         │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │    PNTP Protocol Stack      │   │
│  ├─────────────────────────────┤   │
│  │   Ensemble Algorithm Engine  │   │
│  ├─────────────────────────────┤   │
│  │  Clock Discipline (PLL/FLL)  │   │
│  ├─────────────────────────────┤   │
│  │   Multi-Radio HAL Layer      │   │
│  │  (LoRa/WiFi/Ethernet/WWVB)  │   │
│  └─────────────────────────────┘   │
├─────────────────────────────────────┤
│  Interfaces: PPS, NMEA, MAVLink    │
└─────────────────────────────────────┘
```

### 10.2. Сетевая топология
- Mesh для локальных групп
- Иерархическая для масштабирования
- Динамическая маршрутизация PNTP
- Резервные каналы связи

## 11. Демонстратор системы

### 11.1. Состав демонстратора
- **5 летающих БПЛА** с PNTP-модулями
- **3 наземных узла** (стационарные опорные точки)
- **1 командный пункт** с визуализацией
- **Имитатор GNSS-подавления**

### 11.2. Аппаратная платформа узла
- MCU: STM32H7 или эквивалент (для точных таймстемпов)
- Радиомодули:
  - LoRa SX1276/SX1262 (суб-ГГц)
  - Wi-Fi 6 с HW timestamping
  - WWVB приемник (опционально)
- TCXO/OCXO для стабильности
- IMU для измерения динамики
- GPS/GLONASS (отключаемый)

### 11.3. Программное обеспечение
- RTOS: FreeRTOS или Zephyr
- PNTP stack (разрабатываемый)
- Ensemble algorithms library
- Телеметрия и логирование
- Web-интерфейс мониторинга

## 12. Метрики и методики испытаний

### 12.1. Ключевые метрики

| Метрика | Условия | Порог | Цель | Методика |
|---|---|---|---|---|
| Точность ансамбля (RMS) | 10 БПЛА, полет | ≤ 2 мс | ≤ 1 мс | Сравнение с GPS PPS |
| Сходимость после потери GPS | GPS jamming | ≤ 60 с | ≤ 30 с | Время до стабилизации |
| Устойчивость к потерям узлов | Отказ 30% | Деград ≤ 2× | ≤ 1.5× | Точность оставшихся |
| Масштабируемость | 50→100 узлов | Деград ≤ 50% | ≤ 20% | Рост ошибки синхр. |
| Энергоэффективность | Автономный полет | ≤ 500 мВт | ≤ 300 мВт | Потребление модуля |

### 12.2. Сценарии испытаний

1. **Базовый сценарий:** статические узлы, идеальные условия
2. **Динамический полет:** координированные маневры роя
3. **GNSS-denied:** полная потеря спутниковых сигналов
4. **Помехи и потери:** 20% packet loss, многолучевость
5. **Отказоустойчивость:** последовательный отказ узлов
6. **Масштабирование:** увеличение роя с 10 до 100 единиц

### 12.3. Инструментарий
- Анализатор временных интервалов (PPS comparison)
- SDR для анализа радиоэфира
- Симулятор роевой динамики
- Система сбора и анализа телеметрии

## 13. План-график выполнения работ

### Этап 0: Предварительные исследования (М1-М3)
- Детальный анализ PNTP и существующих реализаций
- Моделирование ансамблей для движущихся платформ
- Выбор оптимальных алгоритмов
- **Результат:** Аналитический отчет, выбор базовых решений

### Этап 1: Теоретические основы (М4-М6)
- Разработка математической модели
- Адаптация PNTP для роевых систем
- Проектирование архитектуры
- **Результат:** Техническое описание системы

### Этап 2: Алгоритмическая база (М7-М9)
- Реализация алгоритмов ансамблирования
- Разработка PNTP протокольного стека
- Создание симулятора
- **Результат:** Библиотеки алгоритмов, симулятор

### Этап 3: Прототипирование (М10-М12)
- Разработка аппаратных модулей
- Интеграция ПО и аппаратуры
- Лабораторные испытания
- **Результат:** Рабочие прототипы узлов

### Этап 4: Демонстратор (М13-М15)
- Сборка демонстратора из 8 узлов
- Разработка системы мониторинга
- Отладка в лабораторных условиях
- **Результат:** Функционирующий демонстратор

### Этап 5: Испытания и валидация (М16-М17)
- Полевые испытания с реальными БПЛА
- Тестирование в GNSS-denied условиях
- Оценка всех метрик
- **Результат:** Протоколы испытаний, анализ результатов

### Этап 6: Документирование (М18)
- Подготовка итогового отчета
- Разработка проекта ТЗ на ОКР
- Оформление патентов
- **Результат:** Полный комплект НТД

## 14. Риски и меры митигации

### 14.1. Технические риски

| Риск | Вероятность | Влияние | Меры митигации |
|---|---|---|---|
| Недостаточная точность HW таймстемпов | Средняя | Высокое | Выбор проверенных чипсетов, резерв на SW компенсацию |
| Сложность реализации PNTP | Средняя | Среднее | Поэтапная разработка, использование существующих наработок |
| Масштабирование до 100 узлов | Высокая | Высокое | Иерархическая архитектура, оптимизация протоколов |
| Релятивистские эффекты незначительны | Низкая | Низкое | Опциональная активация для высоких скоростей |

### 14.2. Организационные риски

| Риск | Меры митигации |
|---|---|
| Недостаток экспертизы в PNTP | Привлечение консультантов, обучение команды |
| Зависимость от импортных компонентов | Проработка отечественных аналогов, резервные варианты |
| Задержки с полевыми испытаниями | Договоренности с полигонами заранее |

## 15. Ожидаемые результаты

### 15.1. Научные результаты
- Новые алгоритмы ансамблирования для движущихся платформ
- Методы компенсации динамических эффектов в PNTP
- Теоретические основы иерархических ансамблей
- 3-5 публикаций в рецензируемых журналах

### 15.2. Практические результаты
- Работающий протокол PNTP для роевых БпС
- Библиотека алгоритмов синхронизации
- Демонстратор на 8+ узлах
- Методики испытаний систем синхронизации

### 15.3. Документация
- Комплект НТД (5 отчетов по этапам)
- Проект ТЗ на ОКР
- Руководства пользователя и разработчика
- Патентные заявки (2-3 шт)

## 16. Требования к исполнителям

- Опыт разработки распределенных систем реального времени
- Знание протоколов синхронизации (NTP/PTP)
- Опыт работы с БпЛА и робототехникой
- Навыки в области обработки сигналов и фильтрации
- Знание теории относительности (желательно)

## 17. Бюджет (ориентировочный)

| Статья расходов | Сумма, млн руб | % |
|---|---|---|
| Оплата труда (15 чел × 18 мес) | 45.0 | 50% |
| Оборудование и компоненты | 18.0 | 20% |
| Испытания и полигоны | 9.0 | 10% |
| Накладные расходы | 13.5 | 15% |
| Резерв | 4.5 | 5% |
| **ИТОГО** | **90.0** | **100%** |

## 18. Критерии успешности НИР

1. Достижение точности синхронизации ≤1 мс в рое из 10+ БПЛА без GNSS
2. Успешная демонстрация работы в GNSS-denied условиях
3. Масштабирование до 50+ узлов с приемлемой деградацией
4. Готовность технологии к переходу на этап ОКР (TRL 4-5)

## 19. Заключение

Данное ТЗ определяет разработку инновационной технологии синхронизации для роевых беспилотных систем, основанной на современных концепциях PNTP и распределенных ансамблей часов. Успешное выполнение НИР обеспечит технологический прорыв в области автономных роевых систем, способных эффективно функционировать в условиях радиоэлектронного противодействия.

— Конец документа —